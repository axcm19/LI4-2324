@using LeiloesOnline.Business;
@using LeiloesOnline.Business.Objects;
@inject NavigationManager NavigationManager

@page "/conta"

<PageTitle>Conta</PageTitle>
<header>
<nav class="navbar navbar-light bg-light">
        <a href="/HomepageLogged">
            <img class="foto-header" src="images/favicon.png" alt="favicon.png" />
        </a>
        <h3 class="titulo"><b>Leiloaria Bracarense Lda.</b></h3>

    <a style="margin-right: 25px;" class="btn btn-primary" href="/conta">A minha conta</a>
</nav>

<hr>
</header>

<center><h1 class="titulo-pag"><b>Conta de Utilizador</b></h1></center>

<p><b>Email: </b> @e_mail </p>

<p><b>Nome: </b> @username </p>

<p><b>Nif: </b> @NIF </p>

<p><b>CC: </b> @CC </p>

<p><b>Morada: </b> @morada </p>

<p><b>Saldo: </b> @carteira <button>Carregar Saldo</button> </p>

<style>
    table, th, td {
        border: 1px solid black;
    }
</style>

<table style="width:40%">
    <tr>
        <th>Lista de artigos:</th>
    </tr>
    @foreach (var item in artigosCurrent)
    {
        <tr>
            <td>ID: @item.Value.getIdArtigo() | TIPO: @item.Value.GetType().Name | NOME: @item.Value.getNome() | DESCRIÇÃO: @item.Value.getDescricao() </td>
        </tr>
    }

    <a class="btn btn-primary btn-sm" href="/criarartigo">Criar Artigo</a>
</table>

<p>       </p>

<style>
    table, th, td {
        border: 1px solid black;
    }
</style>

<table style="width:40%">
    <tr>
        <th>Histórico de licitações:</th>
    </tr>
    @foreach (var item in licitacoes)
    {
        <tr>
            <td>ID: @item.id_leilao | DATA: @item.data_ocorreu | VALOR: @item.valor </td>
        </tr>
    }
</table>

<p>       </p>

<style>
    table, th, td {
        border: 1px solid black;
    }
</style>

<table style="width:40%">
    <tr>
        <th>Histórico de leilões:</th>
    </tr>
    @foreach (var item in leiloes)
    {
        <tr>
            <td>ID: @item.id_leilao | NOME: @item.nome | CATEGORIA: @item.categoria | STATUS: @item.aprovado </td>
        </tr>
    }
</table>


<a class="botao-dir btn btn-primary" @onclick=@setCurrentUserToNull href ="/">Encerrar Sessão</a>

<a class="botao-esq btn btn-primary" href="/HomepageLogged">Voltar</a>


@code {

    private string e_mail = CurrentUser.getCurrentUser().email_participante;
    private string username = CurrentUser.getCurrentUser().username;
    private int NIF = CurrentUser.getCurrentUser().nif;
    private int CC = CurrentUser.getCurrentUser().cc;
    private string morada = CurrentUser.getCurrentUser().morada;
    private float carteira = CurrentUser.getCurrentUser().carteira;
    private Dictionary<int, Artigo> artigosCurrent = CurrentUser.getCurrentUser().meusArtigos;

    private List<Licitacao> licitacoes = new List<Licitacao>();
    private List<Leilao> leiloes = new List<Leilao>();

    void setCurrentUserToNull()
    {
        Participante vazio = new Participante();
        CurrentUser.setCurrentUser(vazio);
    }

    void carregaSaldo(float dinheiro)
    {
        CurrentUser.getCurrentUser().carteira += dinheiro;
    }

    void licitacoesCurrent()
    {
        I_LeiloesOnlineFacade if_leiloes = new LeiloesOnlineFacade();
        licitacoes = if_leiloes.getParticipanteLicitacoes(CurrentUser.getCurrentUser().email_participante);
    }

    void leiloesCurrent()
    {
        I_LeiloesOnlineFacade if_leiloes = new LeiloesOnlineFacade();
        leiloes = if_leiloes.getParticipanteLeiloes(CurrentUser.getCurrentUser().email_participante);
    }

}